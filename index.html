<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Domain Finder - Lost Treasures of the Web</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
/* ===== CSS Custom Properties ===== */
:root {
  --bg-primary: #0f172a;
  --bg-secondary: #1e293b;
  --bg-tertiary: #334155;
  --bg-card: #1e293b;
  --bg-card-hover: #253349;
  --bg-input: #0f172a;
  --border-color: #334155;
  --border-light: #475569;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --text-dim: #64748b;
  --accent-blue: #3b82f6;
  --accent-blue-hover: #2563eb;
  --accent-blue-glow: rgba(59, 130, 246, 0.3);
  --accent-green: #10b981;
  --accent-green-bg: rgba(16, 185, 129, 0.15);
  --accent-amber: #f59e0b;
  --accent-amber-bg: rgba(245, 158, 11, 0.15);
  --accent-red: #ef4444;
  --accent-red-bg: rgba(239, 68, 68, 0.15);
  --accent-purple: #8b5cf6;
  --accent-purple-bg: rgba(139, 92, 246, 0.15);
  --accent-cyan: #06b6d4;
  --accent-cyan-bg: rgba(6, 182, 212, 0.15);
  --accent-pink: #ec4899;
  --gradient-hero: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%);
  --gradient-accent: linear-gradient(135deg, #3b82f6, #8b5cf6);
  --gradient-gold: linear-gradient(135deg, #f59e0b, #f97316);
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
  --shadow-lg: 0 8px 30px rgba(0,0,0,0.5);
  --shadow-glow: 0 0 20px var(--accent-blue-glow);
  --radius-sm: 6px;
  --radius-md: 10px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --transition-fast: 0.15s ease;
  --transition-normal: 0.25s ease;
  --transition-slow: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ===== Reset & Base ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}
a { color: var(--accent-blue); text-decoration: none; transition: color var(--transition-fast); }
a:hover { color: var(--accent-blue-hover); }
button { font-family: inherit; cursor: pointer; border: none; outline: none; }
input, select { font-family: inherit; outline: none; }
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--border-light); }

/* ===== Animations ===== */
@keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes scaleIn { from { opacity: 0; transform: scale(0.92); } to { opacity: 1; transform: scale(1); } }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== Loading Screen ===== */
#loading-screen {
  position: fixed; inset: 0; z-index: 9999;
  background: var(--bg-primary);
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  transition: opacity 0.5s ease, visibility 0.5s ease;
}
#loading-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
.loader-ring {
  width: 56px; height: 56px;
  border: 3px solid var(--bg-tertiary);
  border-top-color: var(--accent-blue);
  border-radius: 50%;
  animation: spin 0.9s linear infinite;
}
.loader-text { margin-top: 20px; color: var(--text-muted); font-size: 0.95rem; letter-spacing: 0.03em; }

/* ===== Error State ===== */
#error-screen {
  display: none; padding: 60px 20px;
  text-align: center; animation: fadeIn 0.5s ease;
}
#error-screen.visible { display: block; }
.error-icon { font-size: 4rem; margin-bottom: 20px; opacity: 0.7; }
.error-title { font-size: 1.75rem; font-weight: 700; margin-bottom: 10px; color: var(--text-primary); }
.error-message { color: var(--text-muted); margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto; line-height: 1.7; }
.error-code {
  background: var(--bg-secondary); border: 1px solid var(--border-color);
  border-radius: var(--radius-md); padding: 16px 24px;
  font-family: 'JetBrains Mono', monospace; font-size: 0.85rem;
  color: var(--accent-amber); display: inline-block; margin-bottom: 24px;
  text-align: left; line-height: 1.8;
}
.error-actions { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }

/* ===== Main Container ===== */
#app { display: none; }
#app.visible { display: block; }

/* ===== Hero Header ===== */
.hero {
  background: var(--gradient-hero);
  position: relative; overflow: hidden;
  padding: 48px 24px 32px;
  border-bottom: 1px solid var(--border-color);
}
.hero::before {
  content: '';
  position: absolute; inset: 0;
  background: radial-gradient(ellipse at 30% 20%, rgba(59,130,246,0.08) 0%, transparent 60%),
              radial-gradient(ellipse at 70% 80%, rgba(139,92,246,0.06) 0%, transparent 60%);
  pointer-events: none;
}
.hero-content { position: relative; max-width: 1400px; margin: 0 auto; }
.hero-top { display: flex; align-items: flex-start; justify-content: space-between; gap: 20px; flex-wrap: wrap; margin-bottom: 24px; }
.hero-title {
  font-size: clamp(1.8rem, 4vw, 2.8rem);
  font-weight: 800; letter-spacing: -0.03em;
  background: linear-gradient(135deg, #f1f5f9, #94a3b8);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text; line-height: 1.2;
}
.hero-title span {
  background: var(--gradient-accent);
  -webkit-background-clip: text; background-clip: text;
  -webkit-text-fill-color: transparent;
}
.hero-subtitle { color: var(--text-muted); font-size: 1.05rem; margin-top: 8px; font-weight: 400; }
.hero-badge {
  display: inline-flex; align-items: center; gap: 8px;
  background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(139,92,246,0.15));
  border: 1px solid rgba(59,130,246,0.3);
  border-radius: 100px; padding: 8px 18px;
  font-size: 0.82rem; color: var(--accent-blue);
  font-weight: 600; white-space: nowrap;
}
.hero-badge .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--accent-green); animation: pulse 2s infinite; }
.hero-meta { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; color: var(--text-dim); font-size: 0.82rem; }

/* ===== Stats Bar ===== */
.stats-bar {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px; max-width: 1400px; margin: 0 auto;
  padding: 0 24px; transform: translateY(-20px);
}
.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  padding: 16px 18px;
  text-align: center;
  transition: all var(--transition-normal);
  animation: fadeInUp 0.5s ease backwards;
}
.stat-card:hover { border-color: var(--accent-blue); transform: translateY(-2px); box-shadow: var(--shadow-glow); }
.stat-card:nth-child(1) { animation-delay: 0.05s; }
.stat-card:nth-child(2) { animation-delay: 0.1s; }
.stat-card:nth-child(3) { animation-delay: 0.15s; }
.stat-card:nth-child(4) { animation-delay: 0.2s; }
.stat-card:nth-child(5) { animation-delay: 0.25s; }
.stat-card:nth-child(6) { animation-delay: 0.3s; }
.stat-number { font-size: 1.6rem; font-weight: 800; font-variant-numeric: tabular-nums; }
.stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; margin-top: 2px; font-weight: 600; }
.stat-number.blue { color: var(--accent-blue); }
.stat-number.green { color: var(--accent-green); }
.stat-number.amber { color: var(--accent-amber); }
.stat-number.red { color: var(--accent-red); }
.stat-number.purple { color: var(--accent-purple); }
.stat-number.cyan { color: var(--accent-cyan); }

/* ===== Top Picks Section ===== */
.top-picks {
  max-width: 1400px; margin: 12px auto 0; padding: 0 24px 32px;
}
.section-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 20px; flex-wrap: wrap; gap: 12px;
}
.section-title {
  font-size: 1.3rem; font-weight: 700;
  display: flex; align-items: center; gap: 10px;
}
.section-title .icon { font-size: 1.4rem; }
.section-subtitle { color: var(--text-muted); font-size: 0.85rem; }
.picks-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 14px;
}
.pick-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 20px;
  position: relative;
  overflow: hidden;
  transition: all var(--transition-normal);
  animation: fadeInUp 0.5s ease backwards;
  cursor: pointer;
}
.pick-card::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: var(--gradient-accent);
  opacity: 0; transition: opacity var(--transition-normal);
}
.pick-card:hover { border-color: var(--accent-blue); transform: translateY(-3px); box-shadow: var(--shadow-lg); }
.pick-card:hover::before { opacity: 1; }
.pick-rank {
  position: absolute; top: 12px; right: 14px;
  width: 28px; height: 28px;
  background: var(--gradient-accent);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 0.75rem; font-weight: 800; color: white;
}
.pick-domain {
  font-size: 1.1rem; font-weight: 700; color: var(--text-primary);
  margin-bottom: 6px; padding-right: 36px;
  word-break: break-all;
}
.pick-score-row {
  display: flex; align-items: center; gap: 10px; margin-bottom: 10px;
}
.pick-score {
  display: flex; align-items: center; gap: 4px;
  font-weight: 700; font-size: 0.9rem;
}
.pick-score .bar-container {
  width: 60px; height: 6px; background: var(--bg-tertiary);
  border-radius: 3px; overflow: hidden;
}
.pick-score .bar-fill {
  height: 100%; border-radius: 3px;
  background: var(--gradient-accent);
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}
.pick-value {
  font-size: 0.82rem; color: var(--accent-green);
  font-weight: 600; font-family: 'JetBrains Mono', monospace;
}
.pick-reason {
  font-size: 0.82rem; color: var(--text-muted);
  line-height: 1.5;
  display: -webkit-box; -webkit-line-clamp: 2;
  -webkit-box-orient: vertical; overflow: hidden;
}
.pick-status {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 3px 10px; border-radius: 100px;
  font-size: 0.72rem; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.05em;
  margin-top: 10px;
}

/* ===== Filter Bar ===== */
.filter-bar {
  position: sticky; top: 0; z-index: 100;
  background: rgba(15, 23, 42, 0.92);
  backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border-color);
  padding: 14px 24px;
  transition: box-shadow var(--transition-normal);
}
.filter-bar.scrolled { box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
.filter-inner {
  max-width: 1400px; margin: 0 auto;
  display: flex; align-items: center; gap: 10px;
  flex-wrap: wrap;
}
.filter-group { display: flex; align-items: center; gap: 6px; }
.filter-label { font-size: 0.72rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.06em; font-weight: 600; white-space: nowrap; }
.filter-input {
  background: var(--bg-input); border: 1px solid var(--border-color);
  border-radius: var(--radius-sm); padding: 8px 12px;
  color: var(--text-primary); font-size: 0.85rem;
  transition: border-color var(--transition-fast);
  min-width: 0;
}
.filter-input:focus { border-color: var(--accent-blue); box-shadow: 0 0 0 3px var(--accent-blue-glow); }
.filter-input::placeholder { color: var(--text-dim); }
#search-input { width: 220px; }
.filter-select {
  background: var(--bg-input); border: 1px solid var(--border-color);
  border-radius: var(--radius-sm); padding: 8px 28px 8px 12px;
  color: var(--text-primary); font-size: 0.85rem;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2.5'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat; background-position: right 8px center;
  cursor: pointer; transition: border-color var(--transition-fast);
}
.filter-select:focus { border-color: var(--accent-blue); }
.score-range { display: flex; align-items: center; gap: 8px; }
.score-range input[type="range"] {
  -webkit-appearance: none; width: 90px; height: 4px;
  background: var(--bg-tertiary); border-radius: 2px; cursor: pointer;
}
.score-range input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none; width: 16px; height: 16px;
  background: var(--accent-blue); border-radius: 50%; cursor: pointer;
  box-shadow: 0 0 6px var(--accent-blue-glow);
}
.score-value {
  font-size: 0.82rem; font-weight: 700; color: var(--accent-blue);
  min-width: 18px; text-align: center;
  font-family: 'JetBrains Mono', monospace;
}
.filter-sep { width: 1px; height: 24px; background: var(--border-color); margin: 0 4px; }
.view-toggle { display: flex; gap: 2px; background: var(--bg-tertiary); border-radius: var(--radius-sm); padding: 2px; }
.view-btn {
  padding: 6px 10px; border-radius: 4px;
  background: transparent; color: var(--text-muted);
  font-size: 0.82rem; font-weight: 500;
  transition: all var(--transition-fast);
}
.view-btn.active { background: var(--accent-blue); color: white; }
.view-btn:hover:not(.active) { color: var(--text-primary); }
.filter-actions { display: flex; gap: 6px; margin-left: auto; }
.action-btn {
  padding: 8px 14px; border-radius: var(--radius-sm);
  font-size: 0.82rem; font-weight: 600;
  transition: all var(--transition-fast);
  display: inline-flex; align-items: center; gap: 6px;
}
.action-btn.primary {
  background: var(--accent-blue); color: white;
}
.action-btn.primary:hover { background: var(--accent-blue-hover); }
.action-btn.secondary {
  background: var(--bg-tertiary); color: var(--text-secondary);
  border: 1px solid var(--border-color);
}
.action-btn.secondary:hover { border-color: var(--border-light); color: var(--text-primary); }
.results-count {
  font-size: 0.82rem; color: var(--text-muted); padding: 6px 0; white-space: nowrap;
}
.results-count strong { color: var(--text-primary); font-weight: 700; }

/* ===== Results Container ===== */
.results-section { max-width: 1400px; margin: 0 auto; padding: 24px; }

/* ===== Card Grid View ===== */
.results-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 16px;
}
.domain-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 22px;
  transition: all var(--transition-normal);
  animation: fadeIn 0.4s ease backwards;
  cursor: default;
  position: relative;
}
.domain-card:hover { border-color: var(--accent-blue); transform: translateY(-2px); box-shadow: var(--shadow-lg); }
.card-header { display: flex; align-items: flex-start; justify-content: space-between; gap: 12px; margin-bottom: 12px; }
.card-domain {
  font-size: 1.05rem; font-weight: 700; color: var(--text-primary);
  word-break: break-all; line-height: 1.3;
}
.card-domain a { color: inherit; }
.card-domain a:hover { color: var(--accent-blue); }
.status-badge {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 4px 10px; border-radius: 100px;
  font-size: 0.7rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.06em;
  white-space: nowrap; flex-shrink: 0;
}
.status-active { background: var(--accent-green-bg); color: var(--accent-green); border: 1px solid rgba(16,185,129,0.3); }
.status-parked { background: var(--accent-cyan-bg); color: var(--accent-cyan); border: 1px solid rgba(6,182,212,0.3); }
.status-for_sale { background: var(--accent-amber-bg); color: var(--accent-amber); border: 1px solid rgba(245,158,11,0.3); }
.status-expired { background: var(--accent-red-bg); color: var(--accent-red); border: 1px solid rgba(239,68,68,0.3); }
.status-available { background: var(--accent-purple-bg); color: var(--accent-purple); border: 1px solid rgba(139,92,246,0.3); }
.status-redirect { background: var(--accent-cyan-bg); color: var(--accent-cyan); border: 1px solid rgba(6,182,212,0.3); }
.card-meta { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
.year-tag {
  padding: 2px 8px; border-radius: 4px;
  background: var(--bg-tertiary); color: var(--text-muted);
  font-size: 0.7rem; font-weight: 600;
  font-family: 'JetBrains Mono', monospace;
}
.card-score-row {
  display: flex; align-items: center; justify-content: space-between;
  gap: 12px; margin-bottom: 10px;
}
.score-display { display: flex; align-items: center; gap: 8px; }
.score-stars { display: flex; gap: 2px; }
.score-star { width: 14px; height: 14px; position: relative; }
.score-star svg { width: 14px; height: 14px; }
.score-star .star-bg { fill: var(--bg-tertiary); }
.score-star .star-fg { fill: var(--accent-amber); }
.score-star .star-half { clip-path: inset(0 50% 0 0); }
.score-num {
  font-size: 0.85rem; font-weight: 800;
  color: var(--accent-amber);
  font-family: 'JetBrains Mono', monospace;
}
.card-value {
  font-size: 0.85rem; font-weight: 700; color: var(--accent-green);
  font-family: 'JetBrains Mono', monospace;
}
.card-reason {
  font-size: 0.82rem; color: var(--text-muted);
  line-height: 1.5; margin-bottom: 14px;
  display: -webkit-box; -webkit-line-clamp: 2;
  -webkit-box-orient: vertical; overflow: hidden;
}
.card-whois {
  border-top: 1px solid var(--border-color);
  padding-top: 12px; margin-top: 4px;
}
.whois-toggle {
  display: flex; align-items: center; gap: 6px;
  background: none; color: var(--text-dim);
  font-size: 0.78rem; font-weight: 600;
  padding: 4px 0; width: 100%;
  text-align: left; transition: color var(--transition-fast);
}
.whois-toggle:hover { color: var(--text-secondary); }
.whois-toggle .arrow { transition: transform var(--transition-fast); font-size: 0.7rem; }
.whois-toggle.open .arrow { transform: rotate(90deg); }
.whois-details {
  max-height: 0; overflow: hidden;
  transition: max-height 0.35s ease, opacity 0.25s ease;
  opacity: 0;
}
.whois-details.open { max-height: 300px; opacity: 1; }
.whois-row {
  display: flex; justify-content: space-between; gap: 10px;
  padding: 5px 0; font-size: 0.78rem;
  border-bottom: 1px solid rgba(51,65,85,0.5);
}
.whois-row:last-child { border-bottom: none; }
.whois-key { color: var(--text-dim); font-weight: 500; white-space: nowrap; }
.whois-val { color: var(--text-secondary); text-align: right; word-break: break-all; }
.card-actions { display: flex; gap: 8px; margin-top: 14px; }
.card-btn {
  flex: 1; padding: 8px 12px;
  border-radius: var(--radius-sm);
  font-size: 0.8rem; font-weight: 600;
  text-align: center;
  transition: all var(--transition-fast);
}
.card-btn.buy { background: var(--gradient-accent); color: white; }
.card-btn.buy:hover { box-shadow: var(--shadow-glow); transform: translateY(-1px); }
.card-btn.details {
  background: var(--bg-tertiary); color: var(--text-secondary);
  border: 1px solid var(--border-color);
}
.card-btn.details:hover { border-color: var(--border-light); color: var(--text-primary); }

/* ===== Table View ===== */
.results-table-wrap { overflow-x: auto; }
.results-table {
  width: 100%; border-collapse: separate; border-spacing: 0;
  font-size: 0.85rem;
}
.results-table thead th {
  position: sticky; top: 0;
  background: var(--bg-secondary);
  padding: 12px 14px; text-align: left;
  font-weight: 700; font-size: 0.75rem;
  text-transform: uppercase; letter-spacing: 0.06em;
  color: var(--text-muted);
  border-bottom: 2px solid var(--border-color);
  white-space: nowrap; cursor: pointer;
  transition: color var(--transition-fast);
}
.results-table thead th:hover { color: var(--text-primary); }
.results-table tbody tr {
  transition: background var(--transition-fast);
  cursor: pointer;
}
.results-table tbody tr:hover { background: var(--bg-card-hover); }
.results-table td {
  padding: 12px 14px;
  border-bottom: 1px solid var(--border-color);
  vertical-align: middle;
}
.results-table .td-domain { font-weight: 600; color: var(--text-primary); }
.results-table .td-score {
  font-weight: 800; color: var(--accent-amber);
  font-family: 'JetBrains Mono', monospace;
}
.results-table .td-value {
  font-weight: 600; color: var(--accent-green);
  font-family: 'JetBrains Mono', monospace; font-size: 0.82rem;
}
.results-table .td-years { display: flex; gap: 4px; flex-wrap: wrap; }

/* ===== Statistics Dashboard ===== */
.stats-dashboard {
  max-width: 1400px; margin: 0 auto; padding: 0 24px 32px;
}
.dashboard-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 20px;
}
.chart-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: 24px;
}
.chart-title {
  font-size: 1rem; font-weight: 700; margin-bottom: 20px;
  display: flex; align-items: center; gap: 8px;
}
/* Pie Chart */
.pie-container { display: flex; align-items: center; gap: 30px; flex-wrap: wrap; justify-content: center; }
.pie-chart {
  width: 180px; height: 180px; border-radius: 50%;
  position: relative; flex-shrink: 0;
}
.pie-center {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 80px; height: 80px;
  background: var(--bg-card);
  border-radius: 50%;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
}
.pie-center-num { font-size: 1.2rem; font-weight: 800; color: var(--text-primary); }
.pie-center-label { font-size: 0.65rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.05em; }
.pie-legend { display: flex; flex-direction: column; gap: 8px; }
.legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.82rem; min-width: 160px; }
.legend-dot { width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0; }
.legend-label { color: var(--text-muted); }
.legend-count { font-weight: 700; color: var(--text-primary); margin-left: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; }
/* Bar Chart */
.bar-chart { display: flex; align-items: flex-end; gap: 4px; height: 160px; padding-top: 10px; }
.bar-col {
  flex: 1; min-width: 16px;
  display: flex; flex-direction: column;
  align-items: center; justify-content: flex-end;
  height: 100%;
}
.bar-rect {
  width: 100%; min-height: 2px;
  background: var(--accent-blue);
  border-radius: 3px 3px 0 0;
  transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1), background var(--transition-fast);
  cursor: pointer; position: relative;
}
.bar-rect:hover { background: var(--accent-purple); }
.bar-label {
  font-size: 0.6rem; color: var(--text-dim);
  margin-top: 6px; transform: rotate(-45deg);
  white-space: nowrap; font-family: 'JetBrains Mono', monospace;
}
.avg-stat {
  display: flex; align-items: center; justify-content: center; gap: 12px;
  padding: 20px; background: var(--bg-tertiary);
  border-radius: var(--radius-md); margin-top: 16px;
}
.avg-stat-num { font-size: 2rem; font-weight: 800; color: var(--accent-blue); }
.avg-stat-label { font-size: 0.85rem; color: var(--text-muted); }

/* ===== Pagination ===== */
.pagination {
  display: flex; align-items: center; justify-content: center;
  gap: 6px; padding: 30px 0 20px;
}
.page-btn {
  min-width: 38px; height: 38px;
  display: flex; align-items: center; justify-content: center;
  border-radius: var(--radius-sm);
  background: var(--bg-card); border: 1px solid var(--border-color);
  color: var(--text-muted); font-size: 0.85rem; font-weight: 600;
  transition: all var(--transition-fast);
}
.page-btn:hover:not(.active):not(:disabled) { border-color: var(--accent-blue); color: var(--text-primary); }
.page-btn.active { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }
.page-btn:disabled { opacity: 0.4; cursor: not-allowed; }
.page-ellipsis { color: var(--text-dim); padding: 0 4px; }

/* ===== Modal ===== */
.modal-overlay {
  position: fixed; inset: 0; z-index: 1000;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
  display: flex; align-items: center; justify-content: center;
  padding: 20px;
  opacity: 0; visibility: hidden;
  transition: all 0.3s ease;
}
.modal-overlay.open { opacity: 1; visibility: visible; }
.modal {
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  width: 100%; max-width: 640px;
  max-height: 85vh; overflow-y: auto;
  padding: 32px;
  transform: scale(0.92) translateY(20px);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
.modal-overlay.open .modal { transform: scale(1) translateY(0); }
.modal-close {
  position: sticky; top: 0; float: right;
  width: 36px; height: 36px;
  background: var(--bg-tertiary); border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  color: var(--text-muted); font-size: 1.2rem;
  transition: all var(--transition-fast); z-index: 1;
}
.modal-close:hover { background: var(--accent-red); color: white; }
.modal-domain {
  font-size: 1.6rem; font-weight: 800;
  margin-bottom: 6px; word-break: break-all;
  padding-right: 48px;
}
.modal-domain a { color: var(--text-primary); }
.modal-domain a:hover { color: var(--accent-blue); }
.modal-section { margin-top: 24px; }
.modal-section-title {
  font-size: 0.78rem; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.08em;
  color: var(--text-dim); margin-bottom: 12px;
  padding-bottom: 8px; border-bottom: 1px solid var(--border-color);
}
.modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.modal-field-label { font-size: 0.72rem; color: var(--text-dim); font-weight: 600; text-transform: uppercase; letter-spacing: 0.04em; }
.modal-field-value { font-size: 0.9rem; color: var(--text-primary); font-weight: 500; margin-top: 2px; word-break: break-all; }
.modal-score-visual {
  display: flex; align-items: center; gap: 14px;
  background: var(--bg-tertiary);
  border-radius: var(--radius-md);
  padding: 16px 20px; margin-top: 8px;
}
.modal-score-num {
  font-size: 2.4rem; font-weight: 900;
  background: var(--gradient-gold);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.modal-score-bar-wrap { flex: 1; }
.modal-score-bar {
  height: 8px; background: var(--bg-primary);
  border-radius: 4px; overflow: hidden;
}
.modal-score-bar-fill {
  height: 100%; border-radius: 4px;
  background: var(--gradient-gold);
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}
.modal-score-label { font-size: 0.82rem; color: var(--text-muted); margin-top: 4px; }
.modal-actions { display: flex; gap: 10px; margin-top: 28px; }
.modal-btn {
  flex: 1; padding: 12px 20px;
  border-radius: var(--radius-md);
  font-size: 0.9rem; font-weight: 700;
  text-align: center;
  transition: all var(--transition-fast);
}
.modal-btn.primary { background: var(--gradient-accent); color: white; }
.modal-btn.primary:hover { box-shadow: var(--shadow-glow); transform: translateY(-1px); }
.modal-btn.secondary {
  background: var(--bg-tertiary); color: var(--text-secondary);
  border: 1px solid var(--border-color);
}
.modal-btn.secondary:hover { border-color: var(--border-light); color: var(--text-primary); }

/* ===== Toast Notification ===== */
.toast {
  position: fixed; bottom: 24px; right: 24px; z-index: 2000;
  background: var(--bg-secondary); border: 1px solid var(--accent-green);
  border-radius: var(--radius-md); padding: 14px 20px;
  color: var(--accent-green); font-size: 0.85rem; font-weight: 600;
  box-shadow: var(--shadow-lg);
  transform: translateY(80px); opacity: 0;
  transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex; align-items: center; gap: 8px;
}
.toast.show { transform: translateY(0); opacity: 1; }

/* ===== Footer ===== */
.footer {
  text-align: center; padding: 40px 24px;
  color: var(--text-dim); font-size: 0.8rem;
  border-top: 1px solid var(--border-color);
  margin-top: 40px;
}

/* ===== Empty Results ===== */
.empty-state {
  text-align: center; padding: 60px 20px; color: var(--text-dim);
}
.empty-state-icon { font-size: 2.5rem; margin-bottom: 12px; opacity: 0.5; }
.empty-state-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 6px; color: var(--text-muted); }
.empty-state-desc { font-size: 0.85rem; }

/* ===== Responsive ===== */
@media (max-width: 768px) {
  .hero { padding: 32px 16px 24px; }
  .hero-title { font-size: 1.6rem; }
  .stats-bar { grid-template-columns: repeat(3, 1fr); padding: 0 16px; gap: 8px; }
  .stat-card { padding: 12px; }
  .stat-number { font-size: 1.2rem; }
  .filter-bar { padding: 12px 16px; }
  .filter-inner { gap: 8px; }
  #search-input { width: 100%; }
  .filter-sep { display: none; }
  .filter-actions { width: 100%; }
  .action-btn { flex: 1; justify-content: center; }
  .results-section { padding: 16px; }
  .results-grid { grid-template-columns: 1fr; }
  .picks-grid { grid-template-columns: 1fr; }
  .top-picks { padding: 0 16px 24px; }
  .dashboard-grid { grid-template-columns: 1fr; }
  .modal { padding: 24px 20px; }
  .modal-grid { grid-template-columns: 1fr; }
  .modal-domain { font-size: 1.2rem; }
}
@media (max-width: 480px) {
  .stats-bar { grid-template-columns: repeat(2, 1fr); }
  .hero-top { flex-direction: column; }
}
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading-screen">
  <div class="loader-ring"></div>
  <div class="loader-text">Loading domain data...</div>
</div>

<!-- Error Screen -->
<div id="error-screen">
  <div class="error-icon">&#9888;</div>
  <h2 class="error-title">Could Not Load Domain Data</h2>
  <p class="error-message">
    The file <strong>domain_results.json</strong> could not be loaded. Make sure it exists in the same directory as this HTML file and that you are serving the page via a web server (not opening the file directly).
  </p>
  <div class="error-code">
    Expected file: ./domain_results.json<br>
    Tip: python3 -m http.server 8000
  </div>
  <div class="error-actions">
    <button class="action-btn primary" id="btn-retry">&#8635; Retry</button>
    <button class="action-btn secondary" id="btn-demo">&#9654; Load Demo Data</button>
  </div>
</div>

<!-- Main App -->
<div id="app">

  <!-- Hero -->
  <header class="hero">
    <div class="hero-content">
      <div class="hero-top">
        <div>
          <h1 class="hero-title">Domain Finder <span>- Lost Treasures</span> of the Web</h1>
          <p class="hero-subtitle">Discover valuable domains from the internet's history</p>
        </div>
        <div class="hero-badge"><span class="dot"></span> <span id="hero-badge-text">Live Data</span></div>
      </div>
      <div class="hero-meta">
        <span id="meta-generated">Generated: --</span>
        <span>|</span>
        <span id="meta-total">Total: --</span>
      </div>
    </div>
  </header>

  <!-- Stats Bar -->
  <div class="stats-bar" id="stats-bar"></div>

  <!-- Top Picks -->
  <section class="top-picks" id="top-picks-section">
    <div class="section-header">
      <div>
        <div class="section-title"><span class="icon">&#11088;</span> Top Picks</div>
        <div class="section-subtitle">Highest-scoring domains available for acquisition</div>
      </div>
    </div>
    <div class="picks-grid" id="picks-grid"></div>
  </section>

  <!-- Statistics Dashboard -->
  <section class="stats-dashboard" id="stats-dashboard">
    <div class="section-header">
      <div>
        <div class="section-title"><span class="icon">&#128202;</span> Analytics Dashboard</div>
        <div class="section-subtitle">Data insights at a glance</div>
      </div>
    </div>
    <div class="dashboard-grid" id="dashboard-grid"></div>
  </section>

  <!-- Filter Bar -->
  <div class="filter-bar" id="filter-bar">
    <div class="filter-inner">
      <div class="filter-group">
        <input type="text" id="search-input" class="filter-input" placeholder="Search domains...">
      </div>
      <div class="filter-group">
        <label class="filter-label" for="status-filter">Status</label>
        <select id="status-filter" class="filter-select">
          <option value="all">All</option>
          <option value="for_sale">For Sale</option>
          <option value="available">Available</option>
          <option value="parked">Parked</option>
          <option value="expired">Expired</option>
          <option value="active">Active</option>
          <option value="redirect">Redirect</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label" for="year-filter">Year</label>
        <select id="year-filter" class="filter-select">
          <option value="all">All Years</option>
        </select>
      </div>
      <div class="filter-group score-range">
        <label class="filter-label" for="score-filter">Score</label>
        <input type="range" id="score-filter" min="1" max="10" value="1" step="1">
        <span class="score-value" id="score-display">1+</span>
      </div>
      <div class="filter-group">
        <label class="filter-label" for="sort-filter">Sort</label>
        <select id="sort-filter" class="filter-select">
          <option value="score_desc">Score (High-Low)</option>
          <option value="score_asc">Score (Low-High)</option>
          <option value="domain_asc">Domain (A-Z)</option>
          <option value="domain_desc">Domain (Z-A)</option>
          <option value="year_desc">Year (Newest)</option>
          <option value="year_asc">Year (Oldest)</option>
          <option value="status">Status</option>
          <option value="value_desc">Value (High-Low)</option>
        </select>
      </div>
      <div class="filter-sep"></div>
      <div class="view-toggle">
        <button class="view-btn active" data-view="grid" title="Card View">&#9638;</button>
        <button class="view-btn" data-view="table" title="Table View">&#9776;</button>
      </div>
      <div class="filter-sep"></div>
      <div class="results-count" id="results-count"></div>
      <div class="filter-actions">
        <button class="action-btn secondary" id="btn-copy" title="Copy domain list">&#128203; Copy</button>
        <button class="action-btn secondary" id="btn-export" title="Export as CSV">&#128229; CSV</button>
      </div>
    </div>
  </div>

  <!-- Results -->
  <section class="results-section">
    <div id="results-container"></div>
    <div class="pagination" id="pagination"></div>
  </section>

  <footer class="footer">
    Domain Finder &mdash; Lost Treasures of the Web &mdash; Built with vanilla JS
  </footer>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal-content"></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
(function() {
  'use strict';

  // --------------- State ---------------
  var allResults = [];
  var filteredResults = [];
  var currentPage = 1;
  var PAGE_SIZE = 50;
  var currentView = 'grid';
  var dataSource = 'live';

  // --------------- DOM refs ---------------
  var loadingScreen = document.getElementById('loading-screen');
  var errorScreen = document.getElementById('error-screen');
  var appEl = document.getElementById('app');
  var searchInput = document.getElementById('search-input');
  var statusFilter = document.getElementById('status-filter');
  var yearFilter = document.getElementById('year-filter');
  var scoreFilter = document.getElementById('score-filter');
  var scoreDisplay = document.getElementById('score-display');
  var sortFilter = document.getElementById('sort-filter');
  var resultsContainer = document.getElementById('results-container');
  var paginationEl = document.getElementById('pagination');
  var resultsCountEl = document.getElementById('results-count');
  var modalOverlay = document.getElementById('modal-overlay');
  var modalContent = document.getElementById('modal-content');
  var toastEl = document.getElementById('toast');

  // --------------- Initialization ---------------
  document.addEventListener('DOMContentLoaded', function() {
    loadData();
    bindEvents();
  });

  function loadData() {
    fetch('./domain_results.json')
      .then(function(res) {
        if (!res.ok) throw new Error('HTTP ' + res.status);
        return res.json();
      })
      .then(function(data) {
        initApp(data, 'live');
      })
      .catch(function(err) {
        console.warn('Failed to load domain_results.json:', err);
        showError();
      });
  }

  function showError() {
    loadingScreen.classList.add('hidden');
    errorScreen.classList.add('visible');
  }

  function initApp(data, source) {
    dataSource = source;
    allResults = (data.results || []).map(function(r, i) {
      r._idx = i;
      return r;
    });

    loadingScreen.classList.add('hidden');
    errorScreen.classList.remove('visible');
    appEl.classList.add('visible');

    if (source === 'demo') {
      document.getElementById('hero-badge-text').textContent = 'Demo Mode';
    }
    document.getElementById('meta-generated').textContent = 'Generated: ' + formatDate(data.generated_at);
    document.getElementById('meta-total').textContent = 'Total domains: ' + (data.total_domains || allResults.length);

    renderStats();
    renderTopPicks();
    renderDashboard();
    populateYearFilter();
    applyFilters();
  }

  // --------------- Demo Data ---------------
  function loadDemoData() {
    var statuses = ['for_sale','active','parked','expired','available','redirect'];
    var registrars = ['GoDaddy','Namecheap','Cloudflare','Google Domains','Tucows','Gandi'];
    var platforms = ['sedo.com','afternic.com','dan.com','godaddy.com','flippa.com'];
    var reasons = [
      'High brand value - short, memorable domain',
      'Strong keyword domain with commercial intent',
      'Exact match domain for growing industry',
      'Premium two-word combination, easy to remember',
      'Valuable .com with established history',
      'Brandable domain with positive connotations',
      'Geographic keyword domain with local SEO value',
      'Trending topic domain with media potential',
      'Classic web 1.0 domain with nostalgia factor',
      'Industry-specific domain with authority potential'
    ];
    var tlds = ['.com','.net','.org','.io','.co'];
    var words1 = ['cyber','web','net','cloud','digital','pixel','code','data','tech','info',
                   'fast','bright','smart','blue','red','green','nova','star','moon','sun',
                   'meta','hyper','ultra','mega','super','pro','elite','prime','alpha','beta'];
    var words2 = ['hub','lab','zone','base','forge','works','flow','wave','link','port',
                  'vault','craft','mind','logic','spark','grid','nest','core','edge','pulse'];

    var results = [];
    for (var i = 0; i < 200; i++) {
      var w1 = words1[Math.floor(Math.random()*words1.length)];
      var w2 = words2[Math.floor(Math.random()*words2.length)];
      var tld = tlds[Math.floor(Math.random()*tlds.length)];
      var domain = w1 + w2 + tld;
      var status = statuses[Math.floor(Math.random()*statuses.length)];
      var score = Math.floor(Math.random()*10)+1;
      var startYear = 1998 + Math.floor(Math.random()*15);
      var years = [];
      var numYears = 1 + Math.floor(Math.random()*6);
      for (var y = 0; y < numYears; y++) years.push(startYear + y);
      var valBase = score * 500 + Math.floor(Math.random()*5000);
      var valHigh = valBase + Math.floor(Math.random()*20000);
      var creationYear = 1996 + Math.floor(Math.random()*20);
      var expYear = 2024 + Math.floor(Math.random()*5);
      results.push({
        domain: domain,
        years_popular: years,
        status: status,
        http_status_code: status === 'active' ? 200 : status === 'redirect' ? 301 : status === 'expired' ? 0 : 200,
        redirect_url: status === 'redirect' ? 'https://example.com/redirect-target' : null,
        page_title: status === 'active' ? w1.charAt(0).toUpperCase() + w1.slice(1) + ' ' + w2.charAt(0).toUpperCase() + w2.slice(1) + ' - Official Site' : '',
        is_parked: status === 'parked',
        is_for_sale: status === 'for_sale',
        sale_platform: (status === 'for_sale') ? platforms[Math.floor(Math.random()*platforms.length)] : null,
        whois: {
          registrar: registrars[Math.floor(Math.random()*registrars.length)],
          creation_date: creationYear + '-' + String(1+Math.floor(Math.random()*12)).padStart(2,'0') + '-' + String(1+Math.floor(Math.random()*28)).padStart(2,'0'),
          expiration_date: expYear + '-' + String(1+Math.floor(Math.random()*12)).padStart(2,'0') + '-' + String(1+Math.floor(Math.random()*28)).padStart(2,'0'),
          name_servers: ['ns1.' + domain, 'ns2.' + domain],
          registrant: 'REDACTED FOR PRIVACY',
          registrant_email: null
        },
        recommendation: {
          score: score,
          reason: reasons[Math.floor(Math.random()*reasons.length)],
          estimated_value: '$' + valBase.toLocaleString() + ' - $' + valHigh.toLocaleString()
        },
        checked_at: new Date(Date.now() - Math.floor(Math.random()*86400000*7)).toISOString()
      });
    }

    initApp({
      generated_at: new Date().toISOString(),
      total_domains: results.length,
      results: results
    }, 'demo');
  }

  // --------------- Safe HTML Helpers ---------------
  function escHtml(str) {
    if (str == null) return '';
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(String(str)));
    return div.textContent;
  }

  function createEl(tag, attrs, children) {
    var el = document.createElement(tag);
    if (attrs) {
      Object.keys(attrs).forEach(function(k) {
        if (k === 'className') el.className = attrs[k];
        else if (k === 'textContent') el.textContent = attrs[k];
        else if (k === 'style' && typeof attrs[k] === 'object') {
          Object.keys(attrs[k]).forEach(function(s) { el.style[s] = attrs[k][s]; });
        } else if (k.startsWith('on')) {
          el.addEventListener(k.slice(2).toLowerCase(), attrs[k]);
        } else el.setAttribute(k, attrs[k]);
      });
    }
    if (children) {
      if (typeof children === 'string') el.textContent = children;
      else if (Array.isArray(children)) children.forEach(function(c) { if (c) el.appendChild(c); });
      else el.appendChild(children);
    }
    return el;
  }

  // --------------- Stats Bar ---------------
  function renderStats() {
    var counts = { total: allResults.length, available: 0, for_sale: 0, parked: 0, active: 0, expired: 0, redirect: 0 };
    allResults.forEach(function(r) { if (counts[r.status] !== undefined) counts[r.status]++; });
    var bar = document.getElementById('stats-bar');
    while (bar.firstChild) bar.removeChild(bar.firstChild);

    var items = [
      { num: counts.total, cls: 'blue', label: 'Total Checked' },
      { num: counts.available, cls: 'purple', label: 'Available' },
      { num: counts.for_sale, cls: 'amber', label: 'For Sale' },
      { num: counts.parked, cls: 'cyan', label: 'Parked' },
      { num: counts.active, cls: 'green', label: 'Active' },
      { num: counts.expired, cls: 'red', label: 'Expired' }
    ];
    items.forEach(function(item) {
      var card = createEl('div', { className: 'stat-card' });
      var numEl = createEl('div', { className: 'stat-number ' + item.cls, textContent: String(item.num) });
      var labelEl = createEl('div', { className: 'stat-label', textContent: item.label });
      card.appendChild(numEl);
      card.appendChild(labelEl);
      bar.appendChild(card);
    });
  }

  // --------------- Top Picks ---------------
  function renderTopPicks() {
    var buyable = allResults
      .filter(function(r) { return r.status === 'for_sale' || r.status === 'available' || r.status === 'expired'; })
      .sort(function(a, b) { return (b.recommendation ? b.recommendation.score : 0) - (a.recommendation ? a.recommendation.score : 0); })
      .slice(0, 10);

    var section = document.getElementById('top-picks-section');
    if (buyable.length === 0) { section.style.display = 'none'; return; }
    section.style.display = '';

    var grid = document.getElementById('picks-grid');
    while (grid.firstChild) grid.removeChild(grid.firstChild);

    buyable.forEach(function(r, i) {
      var card = createEl('div', { className: 'pick-card', style: { animationDelay: (i * 0.06) + 's' } });
      card.addEventListener('click', function() { openModal(r._idx); });

      var rank = createEl('div', { className: 'pick-rank', textContent: String(i + 1) });
      var domainEl = createEl('div', { className: 'pick-domain', textContent: r.domain });
      var scoreRow = createEl('div', { className: 'pick-score-row' });
      var scoreEl = createEl('div', { className: 'pick-score' });
      var scoreText = createEl('span', { textContent: (r.recommendation ? r.recommendation.score : 0) + '/10' });
      var barContainer = createEl('div', { className: 'bar-container' });
      var barFill = createEl('div', { className: 'bar-fill', style: { width: ((r.recommendation ? r.recommendation.score : 0) * 10) + '%' } });
      barContainer.appendChild(barFill);
      scoreEl.appendChild(scoreText);
      scoreEl.appendChild(barContainer);
      var valueEl = createEl('div', { className: 'pick-value', textContent: r.recommendation ? r.recommendation.estimated_value || 'N/A' : 'N/A' });
      scoreRow.appendChild(scoreEl);
      scoreRow.appendChild(valueEl);
      var reasonEl = createEl('div', { className: 'pick-reason', textContent: r.recommendation ? r.recommendation.reason || '' : '' });
      var statusEl = createEl('span', { className: 'pick-status status-' + r.status, textContent: statusLabel(r.status) });

      card.appendChild(rank);
      card.appendChild(domainEl);
      card.appendChild(scoreRow);
      card.appendChild(reasonEl);
      card.appendChild(statusEl);
      grid.appendChild(card);
    });
  }

  // --------------- Dashboard ---------------
  function renderDashboard() {
    var grid = document.getElementById('dashboard-grid');
    while (grid.firstChild) grid.removeChild(grid.firstChild);

    // Status distribution
    var statusCounts = {};
    allResults.forEach(function(r) { statusCounts[r.status] = (statusCounts[r.status] || 0) + 1; });
    var statusColors = {
      active: '#10b981', parked: '#06b6d4',
      for_sale: '#f59e0b', expired: '#ef4444',
      available: '#8b5cf6', redirect: '#6366f1'
    };

    var total = allResults.length || 1;
    var cumPct = 0;
    var segments = [];
    var orderedStatuses = ['active','for_sale','parked','expired','available','redirect'];

    // Pie chart card
    var pieCard = createEl('div', { className: 'chart-card' });
    var pieTitleEl = createEl('div', { className: 'chart-title' });
    pieTitleEl.textContent = 'Status Distribution';
    pieCard.appendChild(pieTitleEl);

    var pieContainer = createEl('div', { className: 'pie-container' });

    orderedStatuses.forEach(function(s) {
      var count = statusCounts[s] || 0;
      if (count === 0) return;
      var pct = (count / total) * 100;
      var color = statusColors[s] || '#475569';
      segments.push(color + ' ' + cumPct + '% ' + (cumPct + pct) + '%');
      cumPct += pct;
    });

    var conicGrad = segments.length ? 'conic-gradient(' + segments.join(', ') + ')' : 'var(--bg-tertiary)';
    var pieChartEl = createEl('div', { className: 'pie-chart', style: { background: conicGrad } });
    var pieCenter = createEl('div', { className: 'pie-center' });
    pieCenter.appendChild(createEl('div', { className: 'pie-center-num', textContent: String(total) }));
    pieCenter.appendChild(createEl('div', { className: 'pie-center-label', textContent: 'Domains' }));
    pieChartEl.appendChild(pieCenter);
    pieContainer.appendChild(pieChartEl);

    var pieLegend = createEl('div', { className: 'pie-legend' });
    orderedStatuses.forEach(function(s) {
      var count = statusCounts[s] || 0;
      if (count === 0) return;
      var item = createEl('div', { className: 'legend-item' });
      item.appendChild(createEl('span', { className: 'legend-dot', style: { background: statusColors[s] } }));
      item.appendChild(createEl('span', { className: 'legend-label', textContent: statusLabel(s) }));
      item.appendChild(createEl('span', { className: 'legend-count', textContent: String(count) }));
      pieLegend.appendChild(item);
    });
    pieContainer.appendChild(pieLegend);
    pieCard.appendChild(pieContainer);
    grid.appendChild(pieCard);

    // Year distribution & average age
    var yearCounts = {};
    allResults.forEach(function(r) {
      (r.years_popular || []).forEach(function(yr) { yearCounts[yr] = (yearCounts[yr] || 0) + 1; });
    });
    var yearsArr = Object.keys(yearCounts).map(Number).sort(function(a, b) { return a - b; });
    var maxYearCount = Math.max.apply(null, Object.values(yearCounts).concat([1]));

    var ageSum = 0, ageCount = 0;
    var now = new Date();
    allResults.forEach(function(r) {
      if (r.whois && r.whois.creation_date) {
        var created = new Date(r.whois.creation_date);
        if (!isNaN(created.getTime())) { ageSum += (now - created) / (365.25 * 86400000); ageCount++; }
      }
    });
    var avgAge = ageCount > 0 ? (ageSum / ageCount).toFixed(1) : 'N/A';

    var barCard = createEl('div', { className: 'chart-card' });
    var barTitleEl = createEl('div', { className: 'chart-title' });
    barTitleEl.textContent = 'Domains by Year';
    barCard.appendChild(barTitleEl);

    var barChart = createEl('div', { className: 'bar-chart' });
    if (yearsArr.length === 0) {
      barChart.appendChild(createEl('div', { style: { color: 'var(--text-dim)', padding: '40px', textAlign: 'center' }, textContent: 'No year data' }));
    } else {
      yearsArr.forEach(function(yr) {
        var c = yearCounts[yr];
        var h = Math.max((c / maxYearCount) * 140, 4);
        var col = createEl('div', { className: 'bar-col' });
        var rect = createEl('div', { className: 'bar-rect', style: { height: h + 'px' }, title: yr + ': ' + c + ' domains' });
        var label = createEl('div', { className: 'bar-label', textContent: String(yr) });
        col.appendChild(rect);
        col.appendChild(label);
        barChart.appendChild(col);
      });
    }
    barCard.appendChild(barChart);

    var avgStatEl = createEl('div', { className: 'avg-stat' });
    avgStatEl.appendChild(createEl('div', { className: 'avg-stat-num', textContent: String(avgAge) }));
    avgStatEl.appendChild(createEl('div', { className: 'avg-stat-label', textContent: avgAge !== 'N/A' ? 'Average Domain Age (years)' : 'No creation date data' }));
    barCard.appendChild(avgStatEl);

    grid.appendChild(barCard);
  }

  // --------------- Year Filter Dropdown ---------------
  function populateYearFilter() {
    var yearsSet = {};
    allResults.forEach(function(r) { (r.years_popular || []).forEach(function(y) { yearsSet[y] = true; }); });
    var years = Object.keys(yearsSet).map(Number).sort(function(a, b) { return b - a; });
    while (yearFilter.options.length > 1) yearFilter.remove(1);
    years.forEach(function(y) {
      var opt = document.createElement('option');
      opt.value = String(y);
      opt.textContent = String(y);
      yearFilter.appendChild(opt);
    });
  }

  // --------------- Filtering & Sorting ---------------
  function applyFilters() {
    var search = searchInput.value.toLowerCase().trim();
    var status = statusFilter.value;
    var year = yearFilter.value;
    var minScore = parseInt(scoreFilter.value) || 1;
    var sort = sortFilter.value;

    filteredResults = allResults.filter(function(r) {
      if (search && r.domain.toLowerCase().indexOf(search) === -1) return false;
      if (status !== 'all' && r.status !== status) return false;
      if (year !== 'all' && (r.years_popular || []).indexOf(parseInt(year)) === -1) return false;
      if ((r.recommendation ? r.recommendation.score : 0) < minScore) return false;
      return true;
    });

    filteredResults.sort(function(a, b) {
      var aScore = a.recommendation ? a.recommendation.score : 0;
      var bScore = b.recommendation ? b.recommendation.score : 0;
      switch (sort) {
        case 'score_desc': return bScore - aScore;
        case 'score_asc': return aScore - bScore;
        case 'domain_asc': return a.domain.localeCompare(b.domain);
        case 'domain_desc': return b.domain.localeCompare(a.domain);
        case 'year_desc': return ((b.years_popular || [])[0] || 0) - ((a.years_popular || [])[0] || 0);
        case 'year_asc': return ((a.years_popular || [])[0] || 9999) - ((b.years_popular || [])[0] || 9999);
        case 'status': return a.status.localeCompare(b.status);
        case 'value_desc': return parseEstimatedValue(b) - parseEstimatedValue(a);
        default: return 0;
      }
    });

    currentPage = 1;
    renderResults();
    renderPagination();
    updateResultsCount();
  }

  function parseEstimatedValue(r) {
    var v = r.recommendation ? r.recommendation.estimated_value || '' : '';
    var match = v.match(/[\d,]+/);
    return match ? parseInt(match[0].replace(/,/g, '')) : 0;
  }

  function updateResultsCount() {
    resultsCountEl.textContent = '';
    var t1 = document.createTextNode('Showing ');
    var strong1 = createEl('strong', { textContent: String(filteredResults.length) });
    var t2 = document.createTextNode(' of ');
    var strong2 = createEl('strong', { textContent: String(allResults.length) });
    resultsCountEl.appendChild(t1);
    resultsCountEl.appendChild(strong1);
    resultsCountEl.appendChild(t2);
    resultsCountEl.appendChild(strong2);
  }

  // --------------- Rendering Results ---------------
  function renderResults() {
    while (resultsContainer.firstChild) resultsContainer.removeChild(resultsContainer.firstChild);
    var start = (currentPage - 1) * PAGE_SIZE;
    var page = filteredResults.slice(start, start + PAGE_SIZE);

    if (page.length === 0) {
      var empty = createEl('div', { className: 'empty-state' });
      empty.appendChild(createEl('div', { className: 'empty-state-icon', textContent: '\uD83D\uDD0D' }));
      empty.appendChild(createEl('div', { className: 'empty-state-title', textContent: 'No domains match your filters' }));
      empty.appendChild(createEl('div', { className: 'empty-state-desc', textContent: 'Try adjusting your search or filter criteria' }));
      resultsContainer.appendChild(empty);
      return;
    }

    if (currentView === 'grid') {
      var gridEl = createEl('div', { className: 'results-grid' });
      page.forEach(function(r, i) { gridEl.appendChild(buildCard(r, i)); });
      resultsContainer.appendChild(gridEl);
    } else {
      var wrap = createEl('div', { className: 'results-table-wrap' });
      var table = createEl('table', { className: 'results-table' });
      var thead = createEl('thead');
      var headRow = createEl('tr');
      ['Domain','Status','Score','Value','Years','Registrar'].forEach(function(h) {
        headRow.appendChild(createEl('th', { textContent: h }));
      });
      thead.appendChild(headRow);
      table.appendChild(thead);
      var tbody = createEl('tbody');
      page.forEach(function(r) { tbody.appendChild(buildTableRow(r)); });
      table.appendChild(tbody);
      wrap.appendChild(table);
      resultsContainer.appendChild(wrap);
    }
  }

  function buildCard(r, i) {
    var card = createEl('div', { className: 'domain-card', style: { animationDelay: (i * 0.03) + 's' } });

    // Header
    var header = createEl('div', { className: 'card-header' });
    var domainWrap = createEl('div', { className: 'card-domain' });
    var domainLink = createEl('a', { href: 'http://' + r.domain, target: '_blank', rel: 'noopener', textContent: r.domain });
    domainLink.addEventListener('click', function(e) { e.stopPropagation(); });
    domainWrap.appendChild(domainLink);
    header.appendChild(domainWrap);
    header.appendChild(createEl('span', { className: 'status-badge status-' + r.status, textContent: statusLabel(r.status) }));
    card.appendChild(header);

    // Year tags
    var years = (r.years_popular || []).slice(0, 8);
    if (years.length) {
      var meta = createEl('div', { className: 'card-meta' });
      years.forEach(function(y) { meta.appendChild(createEl('span', { className: 'year-tag', textContent: String(y) })); });
      if ((r.years_popular || []).length > 8) {
        meta.appendChild(createEl('span', { className: 'year-tag', textContent: '+' + ((r.years_popular || []).length - 8) }));
      }
      card.appendChild(meta);
    }

    // Score row
    var score = r.recommendation ? r.recommendation.score : 0;
    var scoreRow = createEl('div', { className: 'card-score-row' });
    var scoreDisp = createEl('div', { className: 'score-display' });
    scoreDisp.appendChild(buildStarsDOM(score));
    scoreDisp.appendChild(createEl('span', { className: 'score-num', textContent: score + '/10' }));
    scoreRow.appendChild(scoreDisp);
    scoreRow.appendChild(createEl('div', { className: 'card-value', textContent: r.recommendation ? r.recommendation.estimated_value || 'N/A' : 'N/A' }));
    card.appendChild(scoreRow);

    // Reason
    if (r.recommendation && r.recommendation.reason) {
      card.appendChild(createEl('div', { className: 'card-reason', textContent: r.recommendation.reason }));
    }

    // WHOIS
    var whoisData = r.whois || {};
    var whoisSection = createEl('div', { className: 'card-whois' });
    var whoisBtn = createEl('button', { className: 'whois-toggle' });
    var arrow = createEl('span', { className: 'arrow', textContent: '\u25B6' });
    whoisBtn.appendChild(arrow);
    whoisBtn.appendChild(document.createTextNode(' WHOIS Info'));
    var whoisDetails = createEl('div', { className: 'whois-details' });

    var whoisPairs = [
      ['Registrar', whoisData.registrar],
      ['Created', whoisData.creation_date],
      ['Expires', whoisData.expiration_date],
      ['NS', whoisData.name_servers ? whoisData.name_servers.join(', ') : null],
      ['Registrant', whoisData.registrant]
    ];
    whoisPairs.forEach(function(pair) {
      if (!pair[1]) return;
      var row = createEl('div', { className: 'whois-row' });
      row.appendChild(createEl('span', { className: 'whois-key', textContent: pair[0] }));
      row.appendChild(createEl('span', { className: 'whois-val', textContent: pair[1] }));
      whoisDetails.appendChild(row);
    });

    whoisBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      whoisBtn.classList.toggle('open');
      whoisDetails.classList.toggle('open');
    });
    whoisSection.appendChild(whoisBtn);
    whoisSection.appendChild(whoisDetails);
    card.appendChild(whoisSection);

    // Actions
    var actions = createEl('div', { className: 'card-actions' });
    var buyBtn = createEl('button', { className: 'card-btn buy', textContent: r.is_for_sale ? 'Buy Now' : 'Check' });
    buyBtn.addEventListener('click', function(e) { e.stopPropagation(); buyDomain(r._idx); });
    var detailsBtn = createEl('button', { className: 'card-btn details', textContent: 'Details' });
    detailsBtn.addEventListener('click', function(e) { e.stopPropagation(); openModal(r._idx); });
    actions.appendChild(buyBtn);
    actions.appendChild(detailsBtn);
    card.appendChild(actions);

    return card;
  }

  function buildStarsDOM(score) {
    var full = Math.floor(score / 2);
    var half = score % 2;
    var empty = 5 - full - (half ? 1 : 0);
    var container = createEl('div', { className: 'score-stars' });

    function makeStar(type) {
      var span = createEl('span', { className: 'score-star' });
      var svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('viewBox', '0 0 20 20');
      svg.style.width = '14px';
      svg.style.height = '14px';
      var points = '10,1 12.6,7 19,7.6 14,12 15.6,19 10,15.4 4.4,19 6,12 1,7.6 7.4,7';
      if (type === 'full') {
        var poly = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        poly.setAttribute('points', points);
        poly.setAttribute('class', 'star-fg');
        svg.appendChild(poly);
      } else if (type === 'half') {
        var bg = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        bg.setAttribute('points', points);
        bg.setAttribute('class', 'star-bg');
        svg.appendChild(bg);
        var fg = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        fg.setAttribute('points', points);
        fg.setAttribute('class', 'star-fg star-half');
        svg.appendChild(fg);
      } else {
        var ep = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        ep.setAttribute('points', points);
        ep.setAttribute('class', 'star-bg');
        svg.appendChild(ep);
      }
      span.appendChild(svg);
      return span;
    }
    for (var fi = 0; fi < full; fi++) container.appendChild(makeStar('full'));
    if (half) container.appendChild(makeStar('half'));
    for (var ei = 0; ei < empty; ei++) container.appendChild(makeStar('empty'));
    return container;
  }

  function buildTableRow(r) {
    var score = r.recommendation ? r.recommendation.score : 0;
    var years = (r.years_popular || []).slice(0, 5);
    var tr = createEl('tr');
    tr.addEventListener('click', function() { openModal(r._idx); });

    var tdDomain = createEl('td', { className: 'td-domain' });
    var dLink = createEl('a', { href: 'http://' + r.domain, target: '_blank', rel: 'noopener', textContent: r.domain });
    dLink.addEventListener('click', function(e) { e.stopPropagation(); });
    tdDomain.appendChild(dLink);
    tr.appendChild(tdDomain);

    var tdStatus = createEl('td');
    tdStatus.appendChild(createEl('span', { className: 'status-badge status-' + r.status, textContent: statusLabel(r.status) }));
    tr.appendChild(tdStatus);

    tr.appendChild(createEl('td', { className: 'td-score', textContent: score + '/10' }));
    tr.appendChild(createEl('td', { className: 'td-value', textContent: r.recommendation ? r.recommendation.estimated_value || 'N/A' : 'N/A' }));

    var tdYears = createEl('td');
    var yearsDiv = createEl('div', { className: 'td-years' });
    years.forEach(function(y) { yearsDiv.appendChild(createEl('span', { className: 'year-tag', textContent: String(y) })); });
    tdYears.appendChild(yearsDiv);
    tr.appendChild(tdYears);

    tr.appendChild(createEl('td', { style: { color: 'var(--text-muted)', fontSize: '0.82rem' }, textContent: r.whois ? r.whois.registrar || 'N/A' : 'N/A' }));
    return tr;
  }

  // --------------- Pagination ---------------
  function renderPagination() {
    while (paginationEl.firstChild) paginationEl.removeChild(paginationEl.firstChild);
    var totalPages = Math.ceil(filteredResults.length / PAGE_SIZE);
    if (totalPages <= 1) return;

    var prevBtn = createEl('button', { className: 'page-btn', textContent: '\u00AB' });
    if (currentPage === 1) prevBtn.disabled = true;
    prevBtn.addEventListener('click', function() { goToPage(currentPage - 1); });
    paginationEl.appendChild(prevBtn);

    var range = getPageRange(currentPage, totalPages);
    range.forEach(function(p) {
      if (p === '...') {
        paginationEl.appendChild(createEl('span', { className: 'page-ellipsis', textContent: '...' }));
      } else {
        var btn = createEl('button', { className: 'page-btn' + (p === currentPage ? ' active' : ''), textContent: String(p) });
        btn.addEventListener('click', function() { goToPage(p); });
        paginationEl.appendChild(btn);
      }
    });

    var nextBtn = createEl('button', { className: 'page-btn', textContent: '\u00BB' });
    if (currentPage === totalPages) nextBtn.disabled = true;
    nextBtn.addEventListener('click', function() { goToPage(currentPage + 1); });
    paginationEl.appendChild(nextBtn);
  }

  function getPageRange(current, total) {
    if (total <= 7) { var arr = []; for (var i = 1; i <= total; i++) arr.push(i); return arr; }
    var pages = [];
    if (current <= 4) {
      for (var a = 1; a <= 5; a++) pages.push(a);
      pages.push('...', total);
    } else if (current >= total - 3) {
      pages.push(1, '...');
      for (var b = total - 4; b <= total; b++) pages.push(b);
    } else {
      pages.push(1, '...', current - 1, current, current + 1, '...', total);
    }
    return pages;
  }

  function goToPage(p) {
    var totalPages = Math.ceil(filteredResults.length / PAGE_SIZE);
    if (p < 1 || p > totalPages) return;
    currentPage = p;
    renderResults();
    renderPagination();
    document.getElementById('filter-bar').scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  // --------------- Modal ---------------
  function openModal(idx) {
    var r = allResults[idx];
    if (!r) return;

    var score = r.recommendation ? r.recommendation.score : 0;
    var w = r.whois || {};

    while (modalContent.firstChild) modalContent.removeChild(modalContent.firstChild);

    // Close button
    var closeBtn = createEl('button', { className: 'modal-close', textContent: '\u00D7' });
    closeBtn.addEventListener('click', closeModal);
    modalContent.appendChild(closeBtn);

    // Domain
    var domainEl = createEl('div', { className: 'modal-domain' });
    var domainLink = createEl('a', { href: 'http://' + r.domain, target: '_blank', rel: 'noopener', textContent: r.domain });
    domainEl.appendChild(domainLink);
    modalContent.appendChild(domainEl);

    // Status badge
    modalContent.appendChild(createEl('span', { className: 'status-badge status-' + r.status, style: { marginTop: '4px' }, textContent: statusLabel(r.status) }));

    // Page title
    if (r.page_title) {
      modalContent.appendChild(createEl('div', { style: { color: 'var(--text-muted)', fontSize: '0.85rem', marginTop: '8px' }, textContent: r.page_title }));
    }

    // Redirect
    if (r.redirect_url) {
      var redirectDiv = createEl('div', { style: { color: 'var(--text-muted)', fontSize: '0.82rem', marginTop: '6px' } });
      redirectDiv.appendChild(document.createTextNode('Redirects to: '));
      redirectDiv.appendChild(createEl('a', { href: r.redirect_url, target: '_blank', textContent: r.redirect_url }));
      modalContent.appendChild(redirectDiv);
    }

    // Recommendation section
    var recSection = createEl('div', { className: 'modal-section' });
    recSection.appendChild(createEl('div', { className: 'modal-section-title', textContent: 'Recommendation' }));
    var scoreVisual = createEl('div', { className: 'modal-score-visual' });
    scoreVisual.appendChild(createEl('div', { className: 'modal-score-num', textContent: String(score) }));
    var barWrap = createEl('div', { className: 'modal-score-bar-wrap' });
    var barOuter = createEl('div', { className: 'modal-score-bar' });
    barOuter.appendChild(createEl('div', { className: 'modal-score-bar-fill', style: { width: (score * 10) + '%' } }));
    barWrap.appendChild(barOuter);
    barWrap.appendChild(createEl('div', { className: 'modal-score-label', textContent: r.recommendation ? r.recommendation.reason || 'No analysis available' : 'No analysis available' }));
    scoreVisual.appendChild(barWrap);
    recSection.appendChild(scoreVisual);
    modalContent.appendChild(recSection);

    // Details section
    var detailSection = createEl('div', { className: 'modal-section' });
    detailSection.appendChild(createEl('div', { className: 'modal-section-title', textContent: 'Details' }));
    var detailGrid = createEl('div', { className: 'modal-grid' });

    var detailFields = [
      ['Estimated Value', r.recommendation ? r.recommendation.estimated_value || 'N/A' : 'N/A', { color: 'var(--accent-green)', fontWeight: '700' }],
      ['HTTP Status', r.http_status_code ? String(r.http_status_code) : 'N/A', null],
      ['Years Popular', (r.years_popular || []).join(', ') || 'N/A', null],
      ['Checked At', formatDate(r.checked_at), null]
    ];
    if (r.sale_platform) detailFields.push(['Sale Platform', r.sale_platform, null]);
    if (r.is_parked) detailFields.push(['Parked', 'Yes', { color: 'var(--accent-amber)' }]);

    detailFields.forEach(function(f) {
      var field = createEl('div', { className: 'modal-field' });
      field.appendChild(createEl('div', { className: 'modal-field-label', textContent: f[0] }));
      var valEl = createEl('div', { className: 'modal-field-value', textContent: f[1] });
      if (f[2]) { Object.keys(f[2]).forEach(function(k) { valEl.style[k] = f[2][k]; }); }
      if (f[0] === 'Sale Platform') {
        valEl.textContent = '';
        valEl.appendChild(createEl('a', { href: 'https://' + f[1], target: '_blank', textContent: f[1] }));
      }
      field.appendChild(valEl);
      detailGrid.appendChild(field);
    });

    detailSection.appendChild(detailGrid);
    modalContent.appendChild(detailSection);

    // WHOIS section
    var whoisFields = [
      ['Registrar', w.registrar],
      ['Created', w.creation_date],
      ['Expires', w.expiration_date],
      ['Name Servers', w.name_servers ? w.name_servers.join(', ') : null],
      ['Registrant', w.registrant],
      ['Contact Email', w.registrant_email]
    ];
    var hasWhois = whoisFields.some(function(f) { return !!f[1]; });
    if (hasWhois) {
      var whoisSection = createEl('div', { className: 'modal-section' });
      whoisSection.appendChild(createEl('div', { className: 'modal-section-title', textContent: 'WHOIS Information' }));
      var whoisGrid = createEl('div', { className: 'modal-grid' });
      whoisFields.forEach(function(f) {
        if (!f[1]) return;
        var field = createEl('div', { className: 'modal-field' });
        field.appendChild(createEl('div', { className: 'modal-field-label', textContent: f[0] }));
        field.appendChild(createEl('div', { className: 'modal-field-value', textContent: String(f[1]) }));
        whoisGrid.appendChild(field);
      });
      whoisSection.appendChild(whoisGrid);
      modalContent.appendChild(whoisSection);
    }

    // Actions
    var actionsDiv = createEl('div', { className: 'modal-actions' });
    var buyBtn = createEl('button', { className: 'modal-btn primary', textContent: r.is_for_sale ? 'Buy This Domain' : 'Lookup Domain' });
    buyBtn.addEventListener('click', function() { buyDomain(idx); });
    actionsDiv.appendChild(buyBtn);
    var visitLink = createEl('a', {
      className: 'modal-btn secondary',
      href: 'http://' + r.domain,
      target: '_blank',
      rel: 'noopener',
      textContent: 'Visit Site',
      style: { display: 'flex', alignItems: 'center', justifyContent: 'center' }
    });
    actionsDiv.appendChild(visitLink);
    modalContent.appendChild(actionsDiv);

    modalOverlay.classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function closeModal() {
    modalOverlay.classList.remove('open');
    document.body.style.overflow = '';
  }

  // --------------- Buy / Lookup ---------------
  function buyDomain(idx) {
    var r = allResults[idx];
    if (!r) return;
    if (r.is_for_sale && r.sale_platform) {
      window.open('https://' + r.sale_platform, '_blank');
    } else {
      window.open('https://www.whois.com/whois/' + r.domain, '_blank');
    }
  }

  // --------------- Export ---------------
  function exportCSV() {
    var headers = ['Domain','Status','Score','Estimated Value','Years Popular','Registrar','Created','Expires','Reason'];
    var rows = filteredResults.map(function(r) {
      return [
        r.domain,
        r.status,
        r.recommendation ? r.recommendation.score : '',
        r.recommendation ? r.recommendation.estimated_value || '' : '',
        (r.years_popular || []).join('; '),
        r.whois ? r.whois.registrar || '' : '',
        r.whois ? r.whois.creation_date || '' : '',
        r.whois ? r.whois.expiration_date || '' : '',
        r.recommendation ? r.recommendation.reason || '' : ''
      ];
    });
    var csvContent = [headers].concat(rows).map(function(row) {
      return row.map(function(c) { return '"' + String(c).replace(/"/g, '""') + '"'; }).join(',');
    }).join('\n');
    var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    var link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'domain_results_' + new Date().toISOString().slice(0,10) + '.csv';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(link.href);
    showToast('CSV exported successfully');
  }

  function copyDomainList() {
    var list = filteredResults.map(function(r) { return r.domain; }).join('\n');
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(list).then(function() {
        showToast(filteredResults.length + ' domains copied to clipboard');
      }).catch(function() {
        fallbackCopy(list);
      });
    } else {
      fallbackCopy(list);
    }
  }

  function fallbackCopy(text) {
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.left = '-9999px';
    document.body.appendChild(ta);
    ta.select();
    try { document.execCommand('copy'); } catch(e) {}
    document.body.removeChild(ta);
    showToast(filteredResults.length + ' domains copied to clipboard');
  }

  // --------------- Toast ---------------
  function showToast(msg) {
    toastEl.textContent = '\u2713 ' + msg;
    toastEl.classList.add('show');
    setTimeout(function() { toastEl.classList.remove('show'); }, 2800);
  }

  // --------------- Event Binding ---------------
  function bindEvents() {
    searchInput.addEventListener('input', debounce(applyFilters, 200));
    statusFilter.addEventListener('change', applyFilters);
    yearFilter.addEventListener('change', applyFilters);
    sortFilter.addEventListener('change', applyFilters);
    scoreFilter.addEventListener('input', function(e) {
      scoreDisplay.textContent = e.target.value + '+';
      applyFilters();
    });

    document.querySelectorAll('.view-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.querySelectorAll('.view-btn').forEach(function(b) { b.classList.remove('active'); });
        btn.classList.add('active');
        currentView = btn.getAttribute('data-view');
        renderResults();
      });
    });

    document.getElementById('btn-export').addEventListener('click', exportCSV);
    document.getElementById('btn-copy').addEventListener('click', copyDomainList);

    document.getElementById('btn-retry').addEventListener('click', function() { location.reload(); });
    document.getElementById('btn-demo').addEventListener('click', function() { loadDemoData(); });

    modalOverlay.addEventListener('click', function(e) {
      if (e.target === modalOverlay) closeModal();
    });
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeModal();
    });

    // Sticky filter shadow
    var filterBar = document.getElementById('filter-bar');
    if (window.IntersectionObserver) {
      var sentinel = document.querySelector('.hero');
      if (sentinel) {
        var observer = new IntersectionObserver(
          function(entries) { filterBar.classList.toggle('scrolled', !entries[0].isIntersecting); },
          { threshold: 0, rootMargin: '-1px 0px 0px 0px' }
        );
        observer.observe(sentinel);
      }
    }
  }

  // --------------- Utilities ---------------
  function statusLabel(s) {
    var labels = { active: 'Active', parked: 'Parked', for_sale: 'For Sale', expired: 'Expired', available: 'Available', redirect: 'Redirect' };
    return labels[s] || s;
  }

  function formatDate(iso) {
    if (!iso) return 'N/A';
    try {
      var d = new Date(iso);
      if (isNaN(d.getTime())) return iso;
      return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    } catch(e) { return iso; }
  }

  function debounce(fn, ms) {
    var timer;
    return function() {
      var args = arguments;
      var ctx = this;
      clearTimeout(timer);
      timer = setTimeout(function() { fn.apply(ctx, args); }, ms);
    };
  }

})();
</script>
</body>
</html>
